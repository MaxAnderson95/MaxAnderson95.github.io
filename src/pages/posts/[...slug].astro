---
import { getCollection } from "astro:content";
import { getVisiblePosts } from "../../lib/utils";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const posts = getVisiblePosts(allPosts);

  return posts.map((post) => ({
    params: { slug: post.id },
    props: { slug: post.id },
  }));
}

const { slug } = Astro.props as { slug: string };
const target = `/blog/${slug}/`;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="refresh" content={`0;url=${target}`} />
    <link rel="canonical" href={target} />
    <meta name="robots" content="noindex" />
    <script is:inline>{`window.location.replace("${target}");`}</script>
    <title>Redirecting...</title>
  </head>
  <body>
    <p>Redirecting to <a href={target}>{target}</a>.</p>
  </body>
</html>
