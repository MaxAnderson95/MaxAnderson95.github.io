---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navbar from "../../components/Navbar.astro";
import BlogCard from "../../components/BlogCard";
import Footer from "../../components/Footer";
import { getCollection } from "astro:content";
import {
  formatDateShort,
  getVisiblePosts,
  sortPostsByDate,
} from "../../lib/utils";

const allPosts = await getCollection("blog");
const posts = sortPostsByDate(getVisiblePosts(allPosts));
---

<BaseLayout title="Blog â€” Max Anderson">
  <Navbar active="blog" />

  <main id="main-content" class="relative z-10 max-w-[1100px] mx-auto px-6 md:px-10 pt-28 pb-20">
    {/* Header */}
    <div class="reveal mb-12" style="animation-delay: 0.15s;">
      <h1 class="font-display font-extrabold text-[clamp(2rem,5vw,3rem)] tracking-tight leading-tight text-text">
        Blog
      </h1>
      <p class="text-text-secondary text-[1.0625rem] mt-3 max-w-xl">
        Thoughts on DevOps, cloud infrastructure, automation, and the tools that make it all work.
      </p>
    </div>

    {/* Posts grid */}
    <div class="grid gap-4 md:grid-cols-2">
      {posts.map((post, i) => (
        <BlogCard
          slug={post.id}
          title={post.data.title}
          date={formatDateShort(post.data.date)}
          rawDate={post.data.date.toISOString()}
          readTime={post.data.readTime}
          tags={post.data.tags}
          featureImage={post.data.featureImage}
          featureImageAlt={post.data.featureImageAlt}
          excerpt={post.data.excerpt}
          index={i}
        />
      ))}
    </div>
  </main>

  <Footer />
</BaseLayout>
