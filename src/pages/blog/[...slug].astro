---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer";
import { getCollection, render } from "astro:content";
import { formatDate } from "../../lib/utils";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const posts = import.meta.env.DEV
    ? allPosts
    : allPosts.filter((post: any) => !post.data.draft);
  return posts.map((post: any) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<BaseLayout title={`${post.data.title} â€” Max Anderson`}>
  <Navbar active="blog" />

  <main class="relative z-10 max-w-[1100px] mx-auto px-6 md:px-10 pt-28 pb-20">
    <article>
      {/* Header */}
      <header class="reveal mb-12 max-w-3xl" style="animation-delay: 0.15s;">
        {/* Back link */}
        <a
          href="/blog/"
          class="group inline-flex items-center gap-2 text-[13px] text-text-muted hover:text-accent transition-colors mb-8"
        >
          <svg
            class="w-4 h-4 transition-transform duration-200 group-hover:-translate-x-0.5"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
          Back to all posts
        </a>

        {/* Title */}
        <h1 class="font-display font-extrabold text-[clamp(1.8rem,4vw,2.75rem)] tracking-tight text-text leading-snug mb-6">
          {post.data.title}
        </h1>

        {/* Meta */}
        <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-[13px]">
          <span class="text-accent font-mono">{formatDate(post.data.date)}</span>
          <span class="text-border-subtle">|</span>
          <span class="text-text-muted font-mono">{post.data.readTime}</span>
          <span class="text-border-subtle">|</span>
          <div class="flex flex-wrap gap-1.5">
            {post.data.tags.map((tag: string) => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        </div>

        {/* Decorative rule */}
        <div class="mt-8 h-px bg-gradient-to-r from-accent/40 via-border-subtle to-transparent" />
      </header>

      {/* Body */}
      <div class="reveal prose" style="animation-delay: 0.3s;">
        <Content />
      </div>

      {/* Footer */}
      <footer class="reveal mt-16 pt-8 border-t border-border-subtle max-w-3xl" style="animation-delay: 0.4s;">
        <a
          href="/blog/"
          class="group inline-flex items-center gap-2.5 text-[13px] text-text-secondary hover:text-accent transition-all duration-200"
        >
          <span class="inline-flex items-center justify-center w-7 h-7 rounded-md border border-border-subtle group-hover:border-accent/30 transition-colors">
            <svg
              class="w-3.5 h-3.5"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m15 18-6-6 6-6" />
            </svg>
          </span>
          Back to all posts
        </a>
      </footer>
    </article>
  </main>

  <Footer client:idle />
</BaseLayout>
