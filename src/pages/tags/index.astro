---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer";
import { getCollection } from "astro:content";
import { getVisiblePosts, slugifyTag } from "../../lib/utils";

const allPosts = await getCollection("blog");
const posts = getVisiblePosts(allPosts);

const tagCounts = new Map<string, number>();
for (const post of posts) {
  for (const tag of post.data.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}

const tags = [...tagCounts.entries()].sort((a, b) => a[0].localeCompare(b[0]));
---

<BaseLayout title="Tags â€” Max Anderson">
  <Navbar active="blog" />

  <main id="main-content" tabindex="-1" class="relative z-10 max-w-[1100px] mx-auto px-6 md:px-10 pt-28 pb-20">
    <div class="reveal mb-10" style="animation-delay: 0.15s;">
      <h1 class="font-display font-extrabold text-[clamp(2rem,5vw,3rem)] tracking-tight leading-tight text-text">
        Tags
      </h1>
      <p class="text-text-secondary text-[1.0625rem] mt-3 max-w-xl">
        Browse posts by topic.
      </p>
    </div>

    <ul role="list" class="reveal flex flex-wrap gap-3 list-none m-0 p-0" style="animation-delay: 0.25s;">
      {tags.map(([tag, count]) => (
        <li>
          <a class="tag" href={`/tags/${slugifyTag(tag)}/`}>
            {tag} ({count})
          </a>
        </li>
      ))}
    </ul>
  </main>

  <Footer />
</BaseLayout>
