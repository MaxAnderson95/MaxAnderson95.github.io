---
import { siteData } from "../data/site";

const { active = "home" } = Astro.props;

interface Props {
  active?: "home" | "blog" | "certifications" | "work-history";
}
---

<nav
  id="navbar"
  aria-label="Main"
  class="fixed top-0 left-0 right-0 z-50 flex justify-center py-6 pointer-events-none transition-[background-color,border-color,backdrop-filter] duration-500 border-b border-transparent"
>
  <div
    id="nav-container"
    class="flex items-center gap-1 transition-[background-color,border-color,box-shadow] duration-500 pointer-events-auto glass-panel rounded-full px-2 py-2 shadow-2xl shadow-black/50 border-border-highlight/50"
  >
    {/* Navigation Pills */}
    <div
      id="nav-pills"
      class="flex items-center rounded-full p-1 transition-colors duration-500 bg-black/20 border border-white/5"
    >
      <ul role="list" class="flex items-center list-none m-0 p-0">
        <li>
          <a
            href="/"
            aria-current={active === "home" ? "page" : undefined}
            class:list={[
              "relative px-3 md:px-5 py-2 rounded-full text-[0.8125rem] font-medium transition-all duration-300",
              active === "home" ? "text-white" : "text-text-muted hover:text-white"
            ]}
          >
            {active === "home" && (
              <span class="absolute inset-0 bg-white/10 rounded-full border border-white/5 shadow-inner"></span>
            )}
            <span class="relative z-10">Home</span>
          </a>
        </li>
        <li>
          <a
            href="/blog/"
            aria-current={active === "blog" ? "page" : undefined}
            class:list={[
              "relative px-3 md:px-5 py-2 rounded-full text-[0.8125rem] font-medium transition-all duration-300",
              active === "blog" ? "text-white" : "text-text-muted hover:text-white"
            ]}
          >
            {active === "blog" && (
              <span class="absolute inset-0 bg-white/10 rounded-full border border-white/5 shadow-inner"></span>
            )}
            <span class="relative z-10">Blog</span>
          </a>
        </li>
        <li>
          <a
            href="/work-history/"
            aria-current={active === "work-history" ? "page" : undefined}
            class:list={[
              "relative px-3 md:px-5 py-2 rounded-full text-[0.8125rem] font-medium transition-all duration-300",
              active === "work-history" ? "text-white" : "text-text-muted hover:text-white"
            ]}
          >
            {active === "work-history" && (
              <span class="absolute inset-0 bg-white/10 rounded-full border border-white/5 shadow-inner"></span>
            )}
            <span class="relative z-10">Work</span>
          </a>
        </li>
        <li>
          <a
            href="/certifications/"
            aria-current={active === "certifications" ? "page" : undefined}
            class:list={[
              "relative px-3 md:px-5 py-2 rounded-full text-[0.8125rem] font-medium transition-all duration-300",
              active === "certifications" ? "text-white" : "text-text-muted hover:text-white"
            ]}
          >
            {active === "certifications" && (
              <span class="absolute inset-0 bg-white/10 rounded-full border border-white/5 shadow-inner"></span>
            )}
            <span class="relative z-10">Certs</span>
          </a>
        </li>
      </ul>
    </div>

    {/* Separator */}
    <div id="nav-separator" class="hidden sm:block w-px h-6 mx-2 transition-colors duration-500 bg-border" aria-hidden="true"></div>

    {/* Social Icons */}
    <div class="hidden sm:flex items-center gap-1 pr-2">
      <a
        href={siteData.socials.github.url}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2 text-text-muted hover:text-accent hover:bg-white/5 rounded-full transition-all duration-200"
        aria-label="GitHub (opens in new tab)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
          <path d="M9 18c-4.51 2-5-2-7-2" />
        </svg>
      </a>
      <a
        href={siteData.socials.linkedin.url}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2 text-text-muted hover:text-[#0077b5] hover:bg-white/5 rounded-full transition-all duration-200"
        aria-label="LinkedIn (opens in new tab)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
          <rect width="4" height="12" x="2" y="9" />
          <circle cx="4" cy="4" r="2" />
        </svg>
      </a>
      <a
        href={siteData.socials.email.url}
        class="p-2 text-text-muted hover:text-accent hover:bg-white/5 rounded-full transition-all duration-200"
        aria-label="Email"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <rect width="20" height="16" x="2" y="4" rx="2" />
          <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
        </svg>
      </a>
    </div>
  </div>
</nav>

<script>
  let cleanupScrollListener: (() => void) | undefined;

  function initNavbar() {
    const navbar = document.getElementById("navbar");
    const navContainer = document.getElementById("nav-container");
    const navPills = document.getElementById("nav-pills");
    const navSeparator = document.getElementById("nav-separator");

    if (!navbar || !navContainer || !navPills || !navSeparator) return;

    const navbarEl = navbar;
    const navContainerEl = navContainer;
    const navPillsEl = navPills;
    const navSeparatorEl = navSeparator;

    function updateScroll() {
      const scrolled = window.scrollY > 20;

      if (scrolled) {
        // Navbar container becomes the backdrop
        navbarEl.classList.remove("py-6", "pointer-events-none");
        navbarEl.classList.add("py-4", "bg-black/40", "backdrop-blur-md", "border-white/5");
        navbarEl.classList.remove("border-transparent");
        
        // Inner container loses its glass styles
        navContainerEl.classList.remove("glass-panel", "shadow-2xl", "shadow-black/50", "border-border-highlight/50", "px-2", "py-2");
        navContainerEl.classList.add("bg-transparent", "border-transparent", "shadow-none");
        
        // Pills container loses background
        navPillsEl.classList.remove("bg-black/20", "border", "border-white/5");
        navPillsEl.classList.add("bg-transparent", "border-transparent");
        
        // Separator changes color
        navSeparatorEl.classList.remove("bg-border");
        navSeparatorEl.classList.add("bg-white/10");
      } else {
        // Reset to initial state
        navbarEl.classList.add("py-6", "pointer-events-none");
        navbarEl.classList.remove("py-4", "bg-black/40", "backdrop-blur-md", "border-white/5");
        navbarEl.classList.add("border-transparent");
        
        navContainerEl.classList.add("glass-panel", "shadow-2xl", "shadow-black/50", "border-border-highlight/50", "px-2", "py-2");
        navContainerEl.classList.remove("bg-transparent", "border-transparent", "shadow-none");
        
        navPillsEl.classList.add("bg-black/20", "border", "border-white/5");
        navPillsEl.classList.remove("bg-transparent", "border-transparent");
        
        navSeparatorEl.classList.add("bg-border");
        navSeparatorEl.classList.remove("bg-white/10");
      }
    }

    if (cleanupScrollListener) {
      cleanupScrollListener();
    }

    window.addEventListener("scroll", updateScroll, { passive: true });
    cleanupScrollListener = () => {
      window.removeEventListener("scroll", updateScroll);
    };

    // Initial check
    updateScroll();
  }

  // Run on load
  initNavbar();
  
  // Run on view transitions (if enabled in future)
  document.addEventListener("astro:page-load", initNavbar);
</script>
